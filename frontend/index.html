<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VILLEN Music</title>
  <meta name="description" content="VILLEN - Your Premium Personal Music Player">
  <meta name="theme-color" content="#ff6b35">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="VILLEN Music">
  <!-- FIX #23: PWA Manifest for installable web app -->
  <link rel="manifest" href="manifest.json">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <script src="audio-enhancer.js"></script>
</head>

<body>

  <div class="app-container">
    <!-- Dynamic Album Background -->
    <div id="albumBackground"></div>

    <!-- Sidebar -->
    <nav class="sidebar" role="navigation" aria-label="Main navigation">
      <div class="logo">
        <div class="logo-icon" aria-hidden="true">üéß</div>
        <span>VILLEN</span>
      </div>

      <div class="nav-section">
        <div class="nav-label">Library</div>
        <div class="nav-item active" data-section="home" onclick="showSection('home')" role="button" tabindex="0" aria-label="Home section">
          <span class="nav-emoji" aria-hidden="true">üî•</span>
          <span>Trends</span>
        </div>
        <div class="nav-item" data-section="artists" onclick="showSection('artists')" role="button" tabindex="0" aria-label="Artists section">
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path
              d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
          </svg>
          <span>Artists</span>
        </div>
        <div class="nav-item" data-section="albums" onclick="showSection('albums')" role="button" tabindex="0" aria-label="Albums section">
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path
              d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 14.5c-2.49 0-4.5-2.01-4.5-4.5S9.51 7.5 12 7.5s4.5 2.01 4.5 4.5-2.01 4.5-4.5 4.5zm0-5.5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z" />
          </svg>
          <span>Albums</span>
        </div>
        <div class="nav-item" data-section="songs" onclick="showSection('search')" role="button" tabindex="0" aria-label="Songs section">
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z" />
          </svg>
          <span>Songs</span>
        </div>
      </div>

      <div class="nav-section">
        <div class="nav-label">Discover</div>
        <div class="nav-item" data-section="recent" onclick="showSection('recent')" role="button" tabindex="0" aria-label="Recent songs">
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path
              d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z" />
          </svg>
          <span>Recent</span>
        </div>
        <div class="nav-item" data-section="offline" onclick="showSection('offline'), loadOfflineSongs()" role="button" tabindex="0" aria-label="Downloaded songs">
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M5 20h14v-2H5v2zM19 9h-4V3H9v6H5l7 7 7-7z" />
          </svg>
          <span>Downloads</span>
        </div>
        <div class="nav-item" data-section="liked" onclick="showSection('liked')" role="button" tabindex="0" aria-label="Liked songs">
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path
              d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
          </svg>
          <span>Liked</span>
        </div>
        <div class="nav-item" data-section="radio" onclick="showSection('home')" role="button" tabindex="0" aria-label="Radio">
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path
              d="M3.24 6.15C2.51 6.43 2 7.17 2 8v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2H8.3l8.26-3.34L15.88 1 3.24 6.15zM7 20c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm13-8h-2v-2h-2v2H4V8h16v4z" />
          </svg>
          <span>Radio</span>
        </div>
        <div class="nav-item" onclick="showTimerModal()" role="button" tabindex="0" aria-label="Sleep timer">
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path
              d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z" />
          </svg>
          <span>Timer</span>
        </div>
        <div class="nav-item" id="authNavBtn" onclick="toggleAuthModal()" role="button" tabindex="0" aria-label="Login">
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path
              d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z" />
          </svg>
          <span id="authBtnText">Login</span>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Header with Search -->
      <header class="header">
        <div class="search-container">
          <svg class="search-icon" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" />
          </svg>
          <input type="text" id="searchInput" class="search-input" placeholder="Search songs, artists, albums..."
            oninput="handleSearch(this.value)">
        </div>
      </header>

      <!-- Home Section -->
      <section id="homeSection">
        <div class="loading">
          <div class="spinner"></div>
        </div>
      </section>

      <!-- Search Results Section -->
      <section id="searchSection" style="display: none;">
        <div class="section">
          <div class="section-header">
            <h2 class="section-title">üîç Search Results</h2>
          </div>
          <div id="resultsContainer"></div>
        </div>
      </section>

      <!-- Liked Songs Section -->
      <section id="likedSection" style="display: none;">
        <div class="section">
          <div class="section-header">
            <h2 class="section-title">‚ù§Ô∏è Liked Songs</h2>
            <span class="see-all" onclick="playAllLiked()">Play All</span>
          </div>
          <div id="likedContainer"></div>
        </div>
      </section>

      <!-- Artists Section -->
      <section id="artistsSection" style="display: none;">
        <div class="section">
          <div class="section-header">
            <h2 class="section-title">üë§ Top Artists</h2>
          </div>
          <div id="artistsContainer" class="artists-grid"></div>
        </div>
      </section>

      <!-- Albums Section -->
      <section id="albumsSection" style="display: none;">
        <div class="section">
          <div class="section-header">
            <h2 class="section-title">üíø Albums</h2>
          </div>
          <div id="albumsContainer" class="songs-grid"></div>
        </div>
      </section>

      <!-- Recently Played Section -->
      <section id="recentSection" style="display: none;">
        <div class="section">
          <div class="section-header">
            <h2 class="section-title">üïê Recently Played</h2>
            <span class="see-all" onclick="clearRecentlyPlayed()">Clear</span>
          </div>
          <div id="recentContainer"></div>
        </div>
      </section>

      <!-- Offline/Downloads Section -->
      <section id="offlineSection" style="display: none;">
        <div class="section">
          <div class="section-header">
            <h2 class="section-title">‚¨áÔ∏è Downloaded Songs</h2>
            <span class="see-all" onclick="loadOfflineSongs()">Refresh</span>
          </div>
          <div id="offlineContainer"></div>
        </div>
      </section>
    </main>

    <!-- Right Panel -->
    <aside class="right-panel">
      <div class="panel-header">
        <h3 class="panel-title">
          <span class="icon">üéµ</span> Currently Playing
        </h3>
        <div class="header-icons">
          <button class="header-icon-btn" id="themeToggleBtn" data-tooltip="Toggle Dark/Light" onclick="toggleDarkLightMode()">üåô</button>
          <button class="header-icon-btn" data-tooltip="Visualizer" onclick="showVisualizerModal()">üìä</button>
          <button class="header-icon-btn" data-tooltip="Theme" onclick="showThemesModal()">üé®</button>
          <button class="header-icon-btn" data-tooltip="Timer" onclick="showTimerModal()">‚è∞</button>
          <button class="header-icon-btn" data-tooltip="Shortcuts" onclick="showShortcutsModal()">‚å®Ô∏è</button>
        </div>
      </div>

      <!-- Now Playing Card -->
      <div id="currentlyPlayingCard" class="now-playing-card">
        <img id="nowPlayingImage" class="now-playing-image" src="" alt="" style="display: none;">
        <div id="nowPlayingDetails">
          <p style="color: var(--text-muted); font-size: 13px;">No song playing</p>
        </div>
        <!-- Visualizer -->
        <div id="visualizer" class="visualizer-container" style="display: none;">
          <canvas id="visualizerCanvas" class="visualizer-canvas" style="display: none;"></canvas>
          <div class="visualizer-bars">
            <div class="visualizer-bar" style="height: 10px;"></div>
            <div class="visualizer-bar" style="height: 20px;"></div>
            <div class="visualizer-bar" style="height: 15px;"></div>
            <div class="visualizer-bar" style="height: 25px;"></div>
            <div class="visualizer-bar" style="height: 18px;"></div>
            <div class="visualizer-bar" style="height: 30px;"></div>
            <div class="visualizer-bar" style="height: 22px;"></div>
            <div class="visualizer-bar" style="height: 16px;"></div>
            <div class="visualizer-bar" style="height: 28px;"></div>
            <div class="visualizer-bar" style="height: 12px;"></div>
          </div>
        </div>
      </div>

      <!-- Lyrics Panel -->
      <div class="section" id="lyricsSection" style="display: none;">
        <div class="section-header">
          <h3 class="panel-title">üìù Lyrics</h3>
        </div>
        <div id="lyricsPanel" class="lyrics-panel">
          <p class="lyrics-line">Loading lyrics...</p>
        </div>
      </div>

      <!-- Next Songs -->
      <div class="section">
        <div class="section-header">
          <h3 class="panel-title">
            <span class="icon">üìã</span> Next Songs
          </h3>
          <span class="see-all" onclick="toggleQueue()">View All</span>
        </div>
        <div id="nextSongsList" class="next-songs-list">
          <div class="empty-state">
            <p>Queue is empty</p>
          </div>
        </div>
      </div>
    </aside>

    <!-- Player Bar -->
    <footer class="player-bar">
      <!-- Now Playing -->
      <div id="nowPlaying" class="now-playing"></div>

      <!-- Player Controls -->
      <div class="player-controls">
        <div class="control-buttons">
          <button id="shuffleBtn" class="control-btn" data-tooltip="Shuffle (S)" onclick="toggleShuffle()" aria-label="Toggle shuffle" aria-pressed="false">
            <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path
                d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z" />
            </svg>
          </button>
          <button class="control-btn" data-tooltip="Previous (Shift+‚Üê)" onclick="playPrevious()" aria-label="Previous song">
            <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z" />
            </svg>
          </button>
          <button id="playPauseBtn" class="control-btn play-pause-btn" data-tooltip="Play/Pause (Space)"
            onclick="togglePlay()" aria-label="Play or pause">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M8 5v14l11-7z" fill="currentColor" />
            </svg>
          </button>
          <button class="control-btn" data-tooltip="Next (Shift+‚Üí)" onclick="playNext()" aria-label="Next song">
            <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z" />
            </svg>
          </button>
          <button id="repeatBtn" class="control-btn" data-tooltip="Repeat (R)" onclick="toggleRepeat()" aria-label="Toggle repeat" aria-pressed="false">
            <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z" />
            </svg>
          </button>
        </div>

        <div class="progress-container">
          <span id="currentTime" class="time current" aria-label="Current time">0:00</span>
          <div id="progressBar" class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" tabindex="0" aria-label="Playback progress">
            <div id="progressFill" class="fill" style="width: 0%">
              <div class="handle" aria-hidden="true"></div>
            </div>
          </div>
          <span id="duration" class="time" aria-label="Total duration">0:00</span>
        </div>
      </div>

      <!-- Extra Controls -->
      <div class="extra-controls">
        <button id="queueToggle" class="queue-btn" data-tooltip="Queue (Q)" onclick="toggleQueue()">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path
              d="M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v-2H3v2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z" />
          </svg>
        </button>
        <button class="extra-btn" data-tooltip="Like (L)" onclick="if(state.currentSong) toggleLike(state.currentSong)">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
            <path
              d="M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3z" />
          </svg>
        </button>
        <div class="volume-control">
          <button id="volumeBtn" class="control-btn" data-tooltip="Mute (M)"
            onclick="setVolume(state.volume > 0 ? 0 : 0.7)">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z" />
            </svg>
          </button>
          <div id="volumeSlider" class="volume-slider">
            <div id="volumeFill" class="fill" style="width: 70%"></div>
          </div>
        </div>
        <button class="extra-btn" data-tooltip="Equalizer (E)" onclick="showEqualizerModal()">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
          </svg>
        </button>
      </div>
    </footer>

    <!-- Queue Panel -->
    <aside id="queuePanel" class="queue-panel">
      <div class="queue-header">
        <h2>Queue</h2>
        <button class="control-btn" onclick="toggleQueue()">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path
              d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
          </svg>
        </button>
      </div>
      <div id="queueList" class="queue-list"></div>
    </aside>
  </div>

  <!-- Context Menu -->
  <div id="contextMenu" class="context-menu">
    <div class="context-menu-item" onclick="contextMenuAction('play')">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M8 5v14l11-7z" />
      </svg>
      <span>Play Now</span>
    </div>
    <div class="context-menu-item" onclick="contextMenuAction('playNext')">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z" />
      </svg>
      <span>Play Next</span>
    </div>
    <div class="context-menu-item" onclick="contextMenuAction('addQueue')">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path
          d="M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v-2H3v2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z" />
      </svg>
      <span>Add to Queue</span>
    </div>
    <div class="context-menu-divider"></div>
    <div class="context-menu-item" onclick="contextMenuAction('like')">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path
          d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
      </svg>
      <span id="contextLikeText">Add to Liked</span>
    </div>
    <div class="context-menu-divider"></div>
    <div class="context-menu-item" onclick="contextMenuAction('artist')">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path
          d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
      </svg>
      <span>Go to Artist</span>
    </div>
  </div>

  <!-- Keyboard Shortcuts Modal -->
  <div id="shortcutsModal" class="shortcuts-modal" onclick="closeShortcutsModal(event)">
    <div class="shortcuts-content" onclick="event.stopPropagation()">
      <div class="shortcuts-header">
        <h2>‚å®Ô∏è Keyboard Shortcuts</h2>
        <button class="shortcuts-close" onclick="hideShortcutsModal()">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path
              d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
          </svg>
        </button>
      </div>
      <div class="shortcuts-grid">
        <div class="shortcut-item">
          <span class="shortcut-desc">Play/Pause</span>
          <span class="shortcut-key"><kbd>Space</kbd></span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-desc">Next Song</span>
          <span class="shortcut-key"><kbd>Shift</kbd> + <kbd>‚Üí</kbd></span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-desc">Previous Song</span>
          <span class="shortcut-key"><kbd>Shift</kbd> + <kbd>‚Üê</kbd></span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-desc">Seek Forward</span>
          <span class="shortcut-key"><kbd>‚Üí</kbd></span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-desc">Seek Backward</span>
          <span class="shortcut-key"><kbd>‚Üê</kbd></span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-desc">Volume Up</span>
          <span class="shortcut-key"><kbd>‚Üë</kbd></span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-desc">Volume Down</span>
          <span class="shortcut-key"><kbd>‚Üì</kbd></span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-desc">Mute/Unmute</span>
          <span class="shortcut-key"><kbd>M</kbd></span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-desc">Like Current Song</span>
          <span class="shortcut-key"><kbd>L</kbd></span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-desc">Toggle Queue</span>
          <span class="shortcut-key"><kbd>Q</kbd></span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-desc">Shuffle</span>
          <span class="shortcut-key"><kbd>S</kbd></span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-desc">Repeat Mode</span>
          <span class="shortcut-key"><kbd>R</kbd></span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-desc">Show Shortcuts</span>
          <span class="shortcut-key"><kbd>?</kbd></span>
        </div>
        <div class="shortcut-item">
          <span class="shortcut-desc">Focus Search</span>
          <span class="shortcut-key"><kbd>/</kbd></span>
        </div>
      </div>
    </div>
  </div>

  <!-- Sleep Timer Modal -->
  <div id="timerModal" class="timer-modal" onclick="closeTimerModal(event)">
    <div class="timer-content" onclick="event.stopPropagation()">
      <h2>‚è∞ Sleep Timer</h2>
      <div class="timer-options">
        <div class="timer-option" onclick="setSleepTimer(5)">5 minutes</div>
        <div class="timer-option" onclick="setSleepTimer(15)">15 minutes</div>
        <div class="timer-option" onclick="setSleepTimer(30)">30 minutes</div>
        <div class="timer-option" onclick="setSleepTimer(45)">45 minutes</div>
        <div class="timer-option" onclick="setSleepTimer(60)">1 hour</div>
        <div class="timer-option" onclick="setSleepTimer(0)">Off</div>
      </div>
      <p id="timerStatus" style="margin-top: 16px; font-size: 12px; color: var(--text-muted);"></p>
    </div>
  </div>

  <!-- Auth Modal -->
  <div id="authModal" class="auth-modal" onclick="closeAuthModal(event)" style="display: none;">
    <div class="auth-content" onclick="event.stopPropagation()">
      <h2 id="authTitle">Login</h2>
      <form id="authForm" onsubmit="handleAuthSubmit(event)">
        <input type="text" id="authUsername" placeholder="Username" required>
        <div style="position: relative; width: 100%;">
          <input type="password" id="authPassword" placeholder="Password" required oninput="updatePasswordStrength()">
          <!-- FIX #7: Password strength indicator -->
          <div id="passwordStrengthContainer" style="display: none; margin-top: 8px;">
            <div id="passwordStrengthBar" style="height: 6px; background-color: #e0e0e0; border-radius: 3px; overflow: hidden; width: 100%;">
              <div id="passwordStrengthFill" style="height: 100%; width: 0%; transition: width 0.3s ease, background-color 0.3s ease; background-color: #ff6b6b;"></div>
            </div>
            <p id="passwordStrengthText" style="font-size: 12px; margin-top: 4px; color: #ff6b6b; font-weight: 500;">Weak</p>
          </div>
        </div>
        <input type="email" id="authEmail" placeholder="Email (Register only)" style="display: none;">
        <button type="submit" id="authSubmitBtn">Login</button>
      </form>
      <p id="authSwitch" onclick="switchAuthMode()">Don't have an account? Register</p>
      <p id="authMessage" style="color: var(--color-accent); font-size: 13px; margin-top: 10px;"></p>
    </div>
  </div>

  <p id="authMessage" style="color: var(--color-accent); font-size: 13px; margin-top: 10px;"></p>
  </div>
  </div>

  <!-- Themes Modal -->
  <div id="themesModal" class="timer-modal" onclick="closeThemesModal(event)">
    <div class="timer-content" onclick="event.stopPropagation()">
      <h2>üé® Select Theme</h2>
      <div class="timer-options" style="grid-template-columns: 1fr 1fr;">
        <div class="timer-option" onclick="setTheme('default')" style="border-left: 4px solid #9d4edd">Default</div>
        <div class="timer-option" onclick="setTheme('theme-light')" style="border-left: 4px solid #8a2be2">Light</div>
        <div class="timer-option" onclick="setTheme('theme-ocean')" style="border-left: 4px solid #00f2ff">Ocean</div>
        <div class="timer-option" onclick="setTheme('theme-crimson')" style="border-left: 4px solid #ff1e1e">Crimson
        </div>
        <div class="timer-option" onclick="setTheme('theme-emerald')" style="border-left: 4px solid #2eff5f">Emerald
        </div>
        <div class="timer-option" onclick="setTheme('theme-gold')" style="border-left: 4px solid #ffd700">Gold</div>
      </div>
    </div>
  </div>

  <!-- Visualizer Modal -->
  <div id="visualizerModal" class="timer-modal" onclick="closeVisualizerModal(event)">
    <div class="timer-content" onclick="event.stopPropagation()">
      <h2>üìä Visualizer Settings</h2>
      <div class="timer-options" style="grid-template-columns: 1fr;">
        <div class="timer-option" onclick="setVisualizerMode('bars')" style="border-left: 4px solid #00f2ff">Spectrum Bars</div>
        <div class="timer-option" onclick="setVisualizerMode('waveform')" style="border-left: 4px solid #ff2d75">Waveform</div>
        <div class="timer-option" onclick="setVisualizerMode('circular')" style="border-left: 4px solid #2eff5f">Circular Spectrum</div>
        <div class="timer-option" onclick="setVisualizerMode('album')" style="border-left: 4px solid #ffd700">Album Art Overlay</div>
        <div class="timer-option" onclick="toggleVisualizer()" style="border-left: 4px solid #8a2be2">Toggle Visualizer</div>
      </div>
    </div>
  </div>

  <!-- Equalizer Modal -->
  <div id="equalizerModal" class="equalizer-modal" onclick="closeEqualizerModal(event)">
    <div class="equalizer-content" onclick="event.stopPropagation()">
      <div class="equalizer-header">
        <h2>üéµ Equalizer</h2>
        <div class="equalizer-controls">
          <button class="equalizer-btn" onclick="toggleEqualizer()" id="equalizerToggle">Enable EQ</button>
          <button class="equalizer-btn" onclick="resetEqualizer()">Reset</button>
        </div>
      </div>

      <!-- Presets -->
      <div class="equalizer-section">
        <h3>Presets</h3>
        <div class="equalizer-presets">
          <button class="preset-btn active" data-preset="flat" onclick="applyEqualizerPreset('flat')">Flat</button>
          <button class="preset-btn" data-preset="rock" onclick="applyEqualizerPreset('rock')">Rock</button>
          <button class="preset-btn" data-preset="pop" onclick="applyEqualizerPreset('pop')">Pop</button>
          <button class="preset-btn" data-preset="jazz" onclick="applyEqualizerPreset('jazz')">Jazz</button>
          <button class="preset-btn" data-preset="classical" onclick="applyEqualizerPreset('classical')">Classical</button>
          <button class="preset-btn" data-preset="electronic" onclick="applyEqualizerPreset('electronic')">Electronic</button>
          <button class="preset-btn" data-preset="hiphop" onclick="applyEqualizerPreset('hiphop')">Hip Hop</button>
          <button class="preset-btn" data-preset="vocal" onclick="applyEqualizerPreset('vocal')">Vocal Boost</button>
          <button class="preset-btn" data-preset="bass" onclick="applyEqualizerPreset('bass')">Bass Boost</button>
          <button class="preset-btn" data-preset="treble" onclick="applyEqualizerPreset('treble')">Treble Boost</button>
        </div>
      </div>

      <!-- Manual Controls -->
      <div class="equalizer-section">
        <h3>Manual Adjustment</h3>
        <div class="equalizer-sliders">
          <div class="eq-slider">
            <label>32 Hz</label>
            <input type="range" class="eq-range" data-freq="32" min="-20" max="20" value="0" step="0.5" oninput="updateEqualizerBand(32, this.value)">
            <span class="eq-value">0 dB</span>
          </div>
          <div class="eq-slider">
            <label>64 Hz</label>
            <input type="range" class="eq-range" data-freq="64" min="-20" max="20" value="0" step="0.5" oninput="updateEqualizerBand(64, this.value)">
            <span class="eq-value">0 dB</span>
          </div>
          <div class="eq-slider">
            <label>125 Hz</label>
            <input type="range" class="eq-range" data-freq="125" min="-20" max="20" value="0" step="0.5" oninput="updateEqualizerBand(125, this.value)">
            <span class="eq-value">0 dB</span>
          </div>
          <div class="eq-slider">
            <label>250 Hz</label>
            <input type="range" class="eq-range" data-freq="250" min="-20" max="20" value="0" step="0.5" oninput="updateEqualizerBand(250, this.value)">
            <span class="eq-value">0 dB</span>
          </div>
          <div class="eq-slider">
            <label>500 Hz</label>
            <input type="range" class="eq-range" data-freq="500" min="-20" max="20" value="0" step="0.5" oninput="updateEqualizerBand(500, this.value)">
            <span class="eq-value">0 dB</span>
          </div>
          <div class="eq-slider">
            <label>1 kHz</label>
            <input type="range" class="eq-range" data-freq="1000" min="-20" max="20" value="0" step="0.5" oninput="updateEqualizerBand(1000, this.value)">
            <span class="eq-value">0 dB</span>
          </div>
          <div class="eq-slider">
            <label>2 kHz</label>
            <input type="range" class="eq-range" data-freq="2000" min="-20" max="20" value="0" step="0.5" oninput="updateEqualizerBand(2000, this.value)">
            <span class="eq-value">0 dB</span>
          </div>
          <div class="eq-slider">
            <label>4 kHz</label>
            <input type="range" class="eq-range" data-freq="4000" min="-20" max="20" value="0" step="0.5" oninput="updateEqualizerBand(4000, this.value)">
            <span class="eq-value">0 dB</span>
          </div>
          <div class="eq-slider">
            <label>8 kHz</label>
            <input type="range" class="eq-range" data-freq="8000" min="-20" max="20" value="0" step="0.5" oninput="updateEqualizerBand(8000, this.value)">
            <span class="eq-value">0 dB</span>
          </div>
          <div class="eq-slider">
            <label>16 kHz</label>
            <input type="range" class="eq-range" data-freq="16000" min="-20" max="20" value="0" step="0.5" oninput="updateEqualizerBand(16000, this.value)">
            <span class="eq-value">0 dB</span>
          </div>
        </div>
      </div>

      <!-- Crossfade Settings -->
      <div class="equalizer-section">
        <h3>Crossfade</h3>
        <div class="crossfade-controls">
          <label class="toggle-label">
            <input type="checkbox" id="crossfadeToggle" onchange="toggleCrossfade(this.checked)">
            <span class="toggle-slider"></span>
            Enable Crossfade
          </label>
          <div class="crossfade-duration">
            <label>Duration: <span id="crossfadeValue">3</span>s</label>
            <input type="range" id="crossfadeSlider" min="0.5" max="10" value="3" step="0.5" oninput="setCrossfadeDuration(this.value)">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast"></div>

  <!-- FIX #24: Analytics script for tracking user engagement -->
  <script src="analytics.js"></script>
  <script src="app.js"></script>

</body>

</html>